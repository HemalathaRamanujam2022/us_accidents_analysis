## Clone GitHub repository</ins>

Clone the project folder into the local machine from the GitHub
repository using the following command. You need to use your appropriate
GitHub credentials to clone the project.

```
git clone
<https://github.com/HemalathaRamanujam2022/us_accidents_analysis.git>
```

If the clone is successful, all the folders and files required to run
the US accidents data analysis ETL pipeline will be available under the
parent folder "us_accidents_analysis" .

## Install gcloud CLI</ins>

Check if "gcloud SDK" and CLI are installed by running the command
"gcloud --version" on the command prompt.

If gcloud SDK is not installed, please run the script
"setup_gcloud_sdk.sh" to install gloud SDK on the local or virtual
machine. Log out of the machine and get back in to ensure that gcloud
folder is added to the PATH system variable.

## Create GCP Project</ins>

1.  We will now create the GCP project within the Google Cloud Provider
    (GCP) platform. You need to have signed up for a GCP account on the
    free tier or other subscription plans with enough credits to
    run the pipeline.

    From the GCP console, create a new project. Note the project ID
    generated by GCP. Assign the following roles to the
    <YOUR_GCP_EMAIL_ID\> account from the "IAM" tab by choosing "Add
    role". These roles are needed to create a service account using
    gcloud.

-   Project Billing Manager

-   Project IAM Admin

-   Service Account Admin

2.  Switch back to the terminal. Change directory to the parent folder.
    Run the command "gcloud init" on the command prompt. Choose your
    account (<YOUR_GCP_EMAIL_ID>) and the project ID that was created
    in the earlier step.

> ```
>
> gcloud init
>
> gcloud config set account <YOUR_GCP_EMAIL_ID>
>
> gcloud alpha billing accounts list
>
> ```

The output is as below.

```
ACCOUNT_ID          NAME                    OPEN        MASTER_ACCOUNT_ID
XXXXX-XXXXX-XXXXX   My Billing Account      True
```

If you are unable to get the ACCOUNT_ID using the CLI, you can get the
same information from the GCP console under the billing module -
"Billing account ID" from "My Billing Accounts" tab. Note down the
ACCOUNT_ID.
Note: Only 5 projects can be attached to a billing account on the free
tier.

3.  Run the script "setup_gcp_project.sh" from the setup directory.

```
setup/setup_gcp_project.sh <ACCOUNT_ID>  <PROJECT_ID> <YOUR_GCP_EMAIL_ID>
```
This script will create

-   A GCP service account called "us-acci-srvc-acct" and assign all
    required roles to this service account for running the pipeline.

-   Enable all the Google APIs that will be required for Terraform to
    create resources on the GCP.

-   Create a JSON key file for the above service account and put it in
    the .keys folder under the parent folder of the project.

Once the script completes, please check if the service account with the desired roles are created on the GCP console.


